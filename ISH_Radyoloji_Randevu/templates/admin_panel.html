{% extends "base.html" %}
{% block content %}
<h5>Admin Paneli — Kullanıcı Yönetimi</h5>

<form method="post" class="card card-body mb-3">
  <input type="hidden" name="action" value="add">
  <div class="row g-2">
    <div class="col-md-3"><input name="username" placeholder="kullanıcı adı" class="form-control" required></div>
    <div class="col-md-3"><input name="password" placeholder="şifre" class="form-control" required></div>
    <div class="col-md-3">
      <select name="role" class="form-select">
        <option value="doctor">doctor</option>
        <option value="nurse">nurse</option>
        <option value="tech">tech</option>
        <option value="admin">admin</option>
      </select>
    </div>
    <div class="col-md-3"><button class="btn btn-primary w-100">Ekle</button></div>
  </div>
</form>

<table class="table table-sm align-middle bg-white">
  <thead><tr><th>Kullanıcı</th><th>Rol</th><th>Durum</th><th class="text-end">İşlemler</th></tr></thead>
  <tbody>
  {% for u in users %}
    <tr>
      <td>{{ u.username }}</td>
      <td>
        <form method="post" class="d-inline">
          <input type="hidden" name="action" value="role">
          <input type="hidden" name="id" value="{{ u.id }}">
          <select name="role" class="form-select form-select-sm d-inline w-auto" onchange="this.form.submit()">
            {% for r in ['doctor','nurse','tech','admin'] %}
              <option value="{{ r }}" {% if u.role==r %}selected{% endif %}>{{ r }}</option>
            {% endfor %}
          </select>
        </form>
      </td>
      <td>
        <form method="post" class="d-inline">
          <input type="hidden" name="action" value="toggle">
          <input type="hidden" name="id" value="{{ u.id }}">
          <button class="btn btn-sm {% if u.is_active %}btn-success{% else %}btn-secondary{% endif %}">
            {% if u.is_active %}Aktif{% else %}Pasif{% endif %}
          </button>
        </form>
      </td>
      <td class="text-end">
        <form method="post" class="d-inline">
          <input type="hidden" name="action" value="reset">
          <input type="hidden" name="id" value="{{ u.id }}">
          <input type="text" name="new_password" class="form-control form-control-sm d-inline w-auto" placeholder="yeni şifre">
          <button class="btn btn-sm btn-outline-primary">Şifre Sıfırla</button>
        </form>
      </td>
    </tr>
  {% endfor %}
  </tbody>
</table>
{% endblock %}
