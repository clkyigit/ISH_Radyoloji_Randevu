{% extends "base.html" %}
{% block content %}

<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
  <form method="get" action="{{ url_for('agenda') }}" style="display:flex;gap:8px;">
    <input type="date" name="date" value="{{ day_iso }}">
    <button class="btn">Günü Aç</button>
  </form>

  <div style="display:flex;gap:8px;">
    <a class="btn btn-primary" href="{{ url_for('new', date=day_iso) }}">+ Yeni Randevu</a>
  </div>
</div>

<div style="margin-bottom:8px;"><strong>Tarih:</strong> {{ day_iso|tr_date }}</div>

{% if appts|length == 0 %}
  <div class="alert">Bu günde randevu yok.</div>
{% else %}
  <div class="list-group">
  {% for a in appts %}
    <div class="card {% if a.anesthesia %}anesthesia{% endif %}">
      <div style="display:flex;justify-content:space-between;gap:8px;">
        <div>
          <div><strong>{{ a.custom_proc_name or a.proc_name }}</strong> — <span class="muted">{{ a.duration_min }} dk</span></div>
          <div>Hasta: {{ a.patient_name }}{% if a.tc_kimlik %} — <span class="muted">{{ a.tc_kimlik }}</span>{% endif %}</div>
          <div class="muted">
            İlaç:
            {% if a.anticoagulant %} Antikoagülan{% endif %}
            {% if a.antiplatelet %}{% if a.anticoagulant %}+{% endif %} Antiagregan{% endif %}
            {% if not a.anticoagulant and not a.antiplatelet %} — {% endif %}
            {% if a.med_note %} • Not: {{ a.med_note }}{% endif %}
            {% if a.anesthesia %} • <strong>Anestezi</strong>{% endif %}
          </div>
        </div>
        {% if session.get('role') != 'goruntule' %}
        <form method="post"
              action="{{ url_for('delete_appt', appt_id=a.id) }}"
              onsubmit="return confirm('Bu randevuyu silmek istediğinize emin misiniz?');">
          <input type="hidden" name="day_iso" value="{{ day_iso }}">
          <button class="btn btn-danger" title="Sil">Sil</button>
        </form>
        {% endif %}
      </div>
    </div>
  {% endfor %}
  </div>
{% endif %}

{% endblock %}
