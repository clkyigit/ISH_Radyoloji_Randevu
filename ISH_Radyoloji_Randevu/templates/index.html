{% extends 'base.html' %}
{% block title %}Takvim Görünümü{% endblock %}
{% block content %}
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.js'></script>
    <div class="app-container">
        <div class="sidebar">
            {% if current_user.role in ['admin', 'doktor'] %}
            <div class="sidebar-section">
                <a href="{{ url_for('yeni_islem_sayfasi') }}" class="button-add-new">
                    <span class="plus-icon">+</span> Yeni Randevu Ekle
                </a>
            </div>
            {% endif %}
            
            <div class="sidebar-section">
                <h3>Randevu Ara</h3>
                <form action="{{ url_for('arama') }}" method="GET" class="search-form">
                    <input type="search" name="q" placeholder="Arama..." class="search-box" required>
                    <div class="radio-group-search">
                        <input type="radio" id="arama_hasta" name="search_type" value="hasta_adi" checked>
                        <label for="arama_hasta">Hasta Adı</label>
                        <input type="radio" id="arama_islem" name="search_type" value="islem_adi">
                        <label for="arama_islem">İşlem Adı</label>
                    </div>
                    <button type="submit" class="button-search">Ara</button>
                </form>
            </div>
            <div class="sidebar-section">
                <h3>Bugünün Randevuları</h3>
                {% if bugunun_islemleri %}
                    <ul class="today-list">
                    {% for islem in bugunun_islemleri %}
                        <li>{{ islem.hasta_adi }} <small>({{ islem.islem_adi }})</small></li>
                    {% endfor %}
                    </ul>
                {% else %}
                    <p class="no-appointments"><small>Bugün için randevu yok.</small></p>
                {% endif %}
            </div>
        </div>
        <div class="main-content">
            <div id='calendar'></div>
        </div>
    </div>
    <script>
        //... (JavaScript aynı kalıyor)
        document.addEventListener('DOMContentLoaded', function() {
            var calendarEl = document.getElementById('calendar');
            var calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth',
                headerToolbar: {left: 'prev,next today', center: 'title', right: 'dayGridMonth,dayGridWeek,listWeek'},
                locale: 'tr',
                buttonText: {today: 'Bugün', month: 'Ay', week: 'Hafta', list: 'Liste'},
                events: '/api/islemler',
                dateClick: function(info) { window.location.href = `/gun/${info.dateStr}`; }
            });
            calendar.render();
        });
    </script>
{% endblock %}